name: 'php-cs-fixer-action'
description: 'Action to fix PHP code styles'
branding:
  icon: 'check-circle'
  color: green
inputs:
  php-cs-fixer-version:
    description: 'Version of php-cs-fixer to download'
    required: false
    default: 'v3.9.4'
  rules-version:
    description: 'Version of rules to check'
    required: false
    default: 'v1.0'
outputs:
  code-style-result:
    description: 'Report generated by php-cs-fixer'
    value: ${{ steps.php-cs-fixer.outputs.checkstyle-result }}
  pull-request-url:
    description: 'Pull request url'
    value: ${{ steps.pull-request.outputs.pull-request-url }}
runs:
  using: 'composite'
  steps:
    - name: Download php-cs-fixer
      shell: bash
      run: |
        curl --fail -L https://github.com/FriendsOfPHP/PHP-CS-Fixer/releases/download/${{ inputs.php-cs-fixer-version }}/php-cs-fixer.phar -o php-cs-fixer
        chmod a+x php-cs-fixer
        
    - name: Download PHP CS Fixer rules
      shell: bash
      run: curl --fail -L https://github.com/ale94lko/php-cs-fixer-rules/releases/download/${{ inputs.rules-version }}/default.php-cs-fixer.dist.php -o .php-cs-fixer.dist.php  
        
    - name: Run PHP CS Fixer
      id: php-cs-fixer
      shell: bash
      run: |
        ./php-cs-fixer fix --format=checkstyle > ./checkstyle-result.xml
        echo "::set-output name=checkstyle-result::$(cat ./checkstyle-result.xml)"    
        
    - name: Cleanup
      shell: bash
      run: rm -rf ./php-cs-fixer ./checkstyle-result.xml ./.php-cs-fixer.cache